From 28d6755e6222fdce750b5141ef2a6ac15fd81c0d Mon Sep 17 00:00:00 2001
From: ksrt12 <kazakov12stepan2012@live.ru>
Date: Wed, 31 Aug 2016 01:12:17 +0300
Subject: [PATCH] vold: Internal/External switchable SD

Change-Id: Id508d3726d8140fb5b55c9665ee58a981aceede1
---
 main.cpp | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/main.cpp b/main.cpp
index 6852687..440012c 100644
--- a/main.cpp
+++ b/main.cpp
@@ -223,6 +223,16 @@ static void coldboot(const char *path) {
 
 static int process_config(VolumeManager *vm) {
     std::string path(android::vold::DefaultFstabPath());
+
+    /* Load alternate device fstab with switched SD entries if property is set. */
+    char switchable[PROPERTY_VALUE_MAX];
+    property_get("persist.sys.vold.switchexternal", switchable, "0");
+    if (strcmp(switchable,"1") == 0)
+    {
+        path = path + ".switched";
+        LOG(INFO) << "Loading switched fstab";
+    }
+
     fstab = fs_mgr_read_fstab(path.c_str());
     if (!fstab) {
         PLOG(ERROR) << "Failed to open default fstab " << path;
-- 
2.9.3

