From 65e4081fc2bcbdc15c129aa29a30086aec682ab4 Mon Sep 17 00:00:00 2001
From: ksrt12 <kazakov12stepan2012@live.ru>
Date: Fri, 12 Feb 2016 16:17:39 +0600
Subject: [PATCH] kernel ru

Change-Id: Ifed66ddcb73d8dea3ccd49408cf131965f50bd00
---
 core/tasks/kernel.mk        | 13 +++++++++++--
 envsetup.sh                 | 14 ++++++++++++--
 target/product/full_base.mk |  2 +-
 3 files changed, 24 insertions(+), 5 deletions(-)

diff --git a/core/tasks/kernel.mk b/core/tasks/kernel.mk
index 4486044..2fe8542 100644
--- a/core/tasks/kernel.mk
+++ b/core/tasks/kernel.mk
@@ -202,7 +202,16 @@ ifneq ($(USE_CCACHE),)
     ccache := $(strip $(wildcard $(ccache)))
 endif
 
-KERNEL_CROSS_COMPILE := CROSS_COMPILE="$(ccache) $(KERNEL_TOOLCHAIN_PATH)"
+ifneq ($(TARGET_KERNEL_CUSTOM_TOOLCHAIN),)
+MOD_TOOL := $(ANDROID_BUILD_TOP)/$(TARGET_KERNEL_CUSTOM_TOOLCHAIN)
+else
+ifeq ($(KERNEL_ARCH),arm64)
+MOD_TOOL := $(ANDROID_BUILD_TOP)/prebuilts/gcc/$(HOST_OS)-x86/aarch64/aarch64-linux-android-4.9/bin/aarch64-linux-android-
+else
+MOD_TOOL := $(KERNEL_TOOLCHAIN_PATH)
+endif
+endif
+KERNEL_CROSS_COMPILE := CROSS_COMPILE="$(ccache) $(MOD_TOOL)"
 ccache =
 
 define mv-modules
@@ -210,7 +219,7 @@ define mv-modules
     if [ "$$mdpath" != "" ];then\
         mpath=`dirname $$mdpath`;\
         ko=`find $$mpath/kernel -type f -name *.ko`;\
-        for i in $$ko; do $(KERNEL_TOOLCHAIN_PATH)strip --strip-unneeded $$i;\
+        for i in $$ko; do $(MOD_TOOL)strip --strip-unneeded $$i;\
         mv $$i $(KERNEL_MODULES_OUT)/; done;\
     fi
 endef
diff --git a/envsetup.sh b/envsetup.sh
index c62a57f..805d3bd 100644
--- a/envsetup.sh
+++ b/envsetup.sh
@@ -2105,14 +2105,24 @@ function cmrebase() {
 }
 
 function mka() {
+    if [[ $IGNORE_BUILD_ERRORS -eq 1 ]]; then
+        iberr=-i
+    else
+        iberr=
+    fi
+    if [[ $SHOW_DEBUG_INFO -eq 1 ]]; then
+        shdi=-d
+    else
+        shdi=
+    fi
     local T=$(gettop)
     if [ "$T" ]; then
         case `uname -s` in
             Darwin)
-                make -C $T -j `sysctl hw.ncpu|cut -d" " -f2` "$@"
+                make -C $T $iberr $shdi -j `sysctl hw.ncpu|cut -d" " -f2` "$@"
                 ;;
             *)
-                mk_timer schedtool -B -n 1 -e ionice -n 1 make -C $T -j$(cat /proc/cpuinfo | grep "^processor" | wc -l) "$@"
+                mk_timer schedtool -B -n 1 -e ionice -n 1 make -C $T $iberr $shdi -j$(cat /proc/cpuinfo | grep "^processor" | wc -l) "$@"
                 ;;
         esac
 
diff --git a/target/product/full_base.mk b/target/product/full_base.mk
index bac3e03..76c9fc7 100644
--- a/target/product/full_base.mk
+++ b/target/product/full_base.mk
@@ -24,7 +24,7 @@ PRODUCT_PACKAGES := \
     WAPPushManager
 
 # Put en_US first in the list, so make it default.
-PRODUCT_LOCALES := en_US
+PRODUCT_LOCALES := ru_RU
 
 # Get some sounds
 $(call inherit-product-if-exists, frameworks/base/data/sounds/AllAudio.mk)
-- 
2.7.1

